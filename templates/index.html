<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>US Border Redistricting Simulation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geom:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <!-- State tooltip -->
    <div id="stateTooltip">
        <div class="tooltip-name" id="tooltipStateName"></div>
        <div class="tooltip-row">Counties: <span id="tooltipCountyCount"></span></div>
        <div class="tooltip-row">Population: <span id="tooltipPopulation"></span></div>
        <div class="tooltip-row">Electoral Votes: <span id="tooltipEV"></span></div>
        <div class="tooltip-row">Lean: <span id="tooltipLean"></span></div>
    </div>

    <div class="container">
        <div class="viz">
            <div id="loadingState" class="loading">
                <div class="spinner"></div>
                <p>Loading map data...</p>
            </div>
            <div class="viz-container">
                <div class="floating-controls" id="floatingControls" style="display: none;">
                    <div class="iter-box" id="iterBox">
                        <div class="thinking-spinner" id="thinkingSpinner"></div>
                        <div class="iter-label">Current Iteration</div>
                        <div class="iter-value" id="iteration">0</div>
                    </div>

                    <div class="glow-input dual">
                        <div class="dual-row">
                            <label>Iterations</label>
                            <input type="number" id="iterations" min="100" max="150000" value="100000" step="100">
                        </div>
                        <div class="dual-row">
                            <label>Redraw</label>
                            <input type="number" id="renderEvery" min="1" max="500" value="10" step="1">
                        </div>
                    </div>

                    <div class="kway-select purple" id="colorModeKway">
                        <div class="kway-label">Color</div>
                        <div class="kway-options">
                            <div class="kway-option active" data-value="county-partisan" title="County Partisan">
                                <i data-lucide="map-pin" class="kway-icon"></i>
                            </div>
                            <div class="kway-option" data-value="state-partisan" title="State Partisan">
                                <i data-lucide="landmark" class="kway-icon"></i>
                            </div>
                            <div class="kway-option" data-value="state-winner" title="State Winner">
                                <i data-lucide="flag" class="kway-icon"></i>
                            </div>
                            <div class="kway-option" data-value="state" title="State Colors">
                                <i data-lucide="palette" class="kway-icon"></i>
                            </div>
                        </div>
                    </div>

                    <div class="kway-select" id="targetKway">
                        <div class="kway-label">Target</div>
                        <div class="kway-options">
                            <div class="kway-option active rep" data-value="Republican" title="GOP Victory">
                                <span class="kway-icon">üêò</span>
                            </div>
                            <div class="kway-option dem" data-value="Democratic" title="DEM Victory">
                                <span class="kway-icon">ü´è</span>
                            </div>
                            <div class="kway-option tie" data-value="Tie" title="Electoral Tie">
                                <i data-lucide="scale" class="kway-icon"></i>
                            </div>
                        </div>
                    </div>

                    <div class="kway-select cyan" id="modeKway">
                        <div class="kway-label">Algorithm</div>
                        <div class="kway-options">
                            <div class="kway-option active" data-value="standard" title="Standard">
                                <i data-lucide="shuffle" class="kway-icon"></i>
                            </div>
                            <div class="kway-option" data-value="follow_the_leader" title="Follow Leader">
                                <i data-lucide="crown" class="kway-icon"></i>
                            </div>
                            <div class="kway-option" data-value="bfs" title="BFS">
                                <i data-lucide="waves" class="kway-icon"></i>
                            </div>
                            <div class="kway-option" data-value="dfs" title="DFS">
                                <i data-lucide="git-branch" class="kway-icon"></i>
                            </div>
                        </div>
                    </div>

                    <div class="kway-select yellow" id="diffKway">
                        <div class="kway-label">Diff</div>
                        <div class="kway-options">
                            <div class="kway-option active" data-value="off" title="Off">
                                <i data-lucide="eye-off" class="kway-icon"></i>
                            </div>
                            <div class="kway-option" data-value="on" title="On">
                                <i data-lucide="git-compare" class="kway-icon"></i>
                            </div>
                        </div>
                    </div>

                    <div class="glow-buttons">
                        <button class="glow-btn play" id="startBtn"><i data-lucide="play" class="btn-icon"></i></button>
                        <button class="glow-btn pause" id="stopBtn" disabled><i data-lucide="pause" class="btn-icon"></i></button>
                        <button class="glow-btn reset" id="resetBtn"><i data-lucide="rotate-ccw" class="btn-icon"></i></button>
                    </div>
                </div>

                <canvas id="mapCanvas" style="display: none;"></canvas>

                <!-- Floating EV Panel (right side) -->
                <div class="floating-ev" id="floatingEV" style="display: none;">
                    <div class="ev-stats-col">
                        <div class="ev-stat-box">
                            <div class="stat-value purple" id="winnerV">-</div>
                            <div class="stat-label">Projected</div>
                        </div>
                        <div class="ev-stat-box">
                            <div class="stat-value" id="evMarginV">0</div>
                            <div class="stat-label">EV Margin</div>
                        </div>
                        <div class="ev-stat-box">
                            <div class="stat-value" id="swingEVs">0</div>
                            <div class="stat-label">Swing EVs</div>
                        </div>
                        <div class="ev-stat-box stat-carousel" id="evCarousel" style="--carousel-color: #a855f7;">
                            <div class="carousel-items">
                                <div class="carousel-item active" data-key="demshare2">
                                    <div class="stat-value dem" id="demShare2">-</div>
                                    <div class="stat-label">Dem Vote</div>
                                </div>
                                <div class="carousel-item" data-key="repshare2">
                                    <div class="stat-value rep" id="repShare2">-</div>
                                    <div class="stat-label">GOP Vote</div>
                                </div>
                                <div class="carousel-item" data-key="year2">
                                    <div class="stat-value purple">2020</div>
                                    <div class="stat-label">Year</div>
                                </div>
                            </div>
                            <div class="carousel-dots"></div>
                        </div>
                    </div>
                    <div class="ev-bar-vertical">
                        <div class="ev-bar-track">
                            <div class="ev-bar-rep-v" id="evRepBarV"><span id="evRepV">0</span></div>
                            <div class="ev-bar-rep-swing-v" id="evRepSwingBarV"><span id="evRepSwingV"></span></div>
                            <div class="ev-bar-dem-swing-v" id="evDemSwingBarV"><span id="evDemSwingV"></span></div>
                            <div class="ev-bar-dem-v" id="evDemBarV"><span id="evDemV">0</span></div>
                            <div class="ev-270-line"></div>
                            <span class="ev-total-label rep" id="evTotalRep">0</span>
                            <span class="ev-total-label dem" id="evTotalDem">0</span>
                        </div>
                    </div>
                </div>
            </div>

                <div class="dashboard" id="dashboard" style="display: none;">
                    <!-- Tipping Point State -->
                    <div class="dash-card" id="tippingCard" style="--accent: #a855f7;">
                        <div class="dash-label">Tipping Point</div>
                        <div class="dash-value" id="tippingState" style="color: #a855f7;">-</div>
                        <div class="dash-subtitle" id="tippingSubtitle">decides the election</div>
                        <div class="tipping-histogram" id="tippingHistogram"></div>
                    </div>

                    <!-- Algorithm Score -->
                    <div class="dash-card" id="scoreCard" style="--accent: #00d4ff;">
                        <div class="dash-label">Algorithm Score</div>
                        <div class="dash-value" id="currentScore" style="color: #00d4ff;">0.00</div>
                        <div class="dash-subtitle" id="scoreSubtitle">higher is better</div>
                        <div class="score-chart" id="scoreChart">
                            <svg viewBox="0 0 200 30" preserveAspectRatio="none">
                                <defs>
                                    <linearGradient id="scoreGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" style="stop-color:#00d4ff;stop-opacity:0.5" />
                                        <stop offset="100%" style="stop-color:#00d4ff;stop-opacity:0" />
                                    </linearGradient>
                                </defs>
                                <path class="score-area" id="scoreArea" d=""></path>
                                <path class="score-line" id="scoreLine" d=""></path>
                            </svg>
                        </div>
                    </div>

                    <!-- Swing States -->
                    <div class="dash-card" id="swingCard" style="--accent: #fbbf24;">
                        <div class="dash-label">Swing States</div>
                        <div class="dash-value" id="swingStates">0</div>
                        <div class="dash-subtitle">within ¬±5% lean</div>
                        <div class="stat-chart">
                            <svg viewBox="0 0 200 30" preserveAspectRatio="none">
                                <defs>
                                    <linearGradient id="yellowGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" style="stop-color:#fbbf24;stop-opacity:0.5" />
                                        <stop offset="100%" style="stop-color:#fbbf24;stop-opacity:0" />
                                    </linearGradient>
                                </defs>
                                <path class="stat-area yellow" id="swingArea" d=""></path>
                                <path class="stat-line yellow" id="swingLine" d=""></path>
                            </svg>
                        </div>
                    </div>

                    <!-- EV Margin / Electoral Efficiency -->
                    <div class="dash-card" id="fairnessCard" style="--accent: #a855f7;">
                        <div class="dash-label">EV Margin</div>
                        <div class="dash-value" id="evMarginPct" style="color: #a855f7;">0%</div>
                        <div class="dash-subtitle"><span id="fairnessScore">0%</span> efficiency</div>
                        <div class="stat-chart">
                            <svg viewBox="0 0 200 30" preserveAspectRatio="none">
                                <defs>
                                    <linearGradient id="purpleGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" style="stop-color:#a855f7;stop-opacity:0.5" />
                                        <stop offset="100%" style="stop-color:#a855f7;stop-opacity:0" />
                                    </linearGradient>
                                </defs>
                                <path class="stat-area purple" id="fairnessArea" d=""></path>
                                <path class="stat-line purple" id="fairnessLine" d=""></path>
                            </svg>
                        </div>
                    </div>

                    <!-- Partisan Distribution Histogram -->
                    <div class="dash-card partisan-card" style="--accent: #a855f7; grid-column: span 2;">
                        <div class="histogram" id="partisanHistogram"></div>
                        <div class="partisan-overlay">
                            <div class="dash-label">State Partisan Distribution</div>
                            <div class="mini-stats" style="border: none; padding: 0;">
                                <div class="mini-stat">
                                    <div class="mini-stat-value" id="safeBlue">0</div>
                                    <div class="mini-stat-label">Safe D</div>
                                </div>
                                <div class="mini-stat">
                                    <div class="mini-stat-value" id="leanBlue">0</div>
                                    <div class="mini-stat-label">Likely D</div>
                                </div>
                                <div class="mini-stat">
                                    <div class="mini-stat-value" id="tossup">0</div>
                                    <div class="mini-stat-label">Tossup/Leans</div>
                                </div>
                                <div class="mini-stat">
                                    <div class="mini-stat-value" id="leanRed">0</div>
                                    <div class="mini-stat-label">Likely R</div>
                                </div>
                                <div class="mini-stat">
                                    <div class="mini-stat-value" id="safeRed">0</div>
                                    <div class="mini-stat-label">Safe R</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="/static/main.js"></script>
</body>
</html>
